let nx1;
let ny1;
let nsA;
let nx2;
let ny2;
let nsB;
let points = [];
let images = [];
let letters = "ある日の事でございます。御釈迦様は極楽の蓮池のふちを、独りでぶらぶら御歩きになっていらっしゃいました。池の中に咲いている蓮の花は、みんな玉のようにまっ白で、そのまん中にある金色の蕊からは、何とも云えない好い匂が、絶間なくあたりへ溢れて居ります。極楽は丁度朝なのでございましょう。やがて御釈迦様はその池のふちに御佇みになって、水の面を蔽っている蓮の葉の間から、ふと下の容子を御覧になりました。この極楽の蓮池の下は、丁度地獄の底に当って居りますから、水晶のような水を透き徹して、三途の河や針の山の景色が、丁度覗き眼鏡を見るように、はっきりと見えるのでございます。するとその地獄の底に、カン陀多と云う男が一人、ほかの罪人と一しょに蠢いている姿が、御眼に止まりました。このカン陀多と云う男は、人を殺したり家に火をつけたり、いろいろ悪事を働いた大泥坊でございますが、それでもたった一つ、善い事を致した覚えがございます。と申しますのは、ある時この男が深い林の中を通りますと、小さな蜘蛛が一匹、路ばたを這って行くのが見えました。そこでカン陀多は早速足を挙げて、踏み殺そうと致しましたが、「いや、いや、これも小さいながら、命のあるものに違いない。その命を無暗にとると云う事は、いくら何でも可哀そうだ。」と、こう急に思い返して、とうとうその蜘蛛を殺さずに助けてやったからでございます。御釈迦様は地獄の容子を御覧になりながら、このカン陀多には蜘蛛を助けた事があるのを御思い出しになりました。そうしてそれだけの善い事をした報《むくい》には、出来るなら、この男を地獄から救い出してやろうと御考えになりました。幸い、側を見ますと、翡翠《ひすい》のような色をした蓮の葉の上に、極楽の蜘蛛が一匹、美しい銀色の糸をかけて居ります。御釈迦様はその蜘蛛の糸をそっと御手に御取りになって、玉のような白蓮の間から、遥か下にある地獄の底へ、まっすぐにそれを御｜下しなさいました。こちらは地獄の底の血の池で、ほかの罪人と一しょに、浮いたり沈んだりしていたカン陀多でございます。何しろどちらを見ても、まっ暗で、たまにそのくら暗からぼんやり浮き上っているものがあると思いますと、それは恐しい針の山の針が光るのでございますから、その心細さと云ったらございません。その上あたりは墓の中のようにしんと静まり返って、たまに聞えるものと云っては、ただ罪人がつく微な嘆息ばかりでございます。これはここへ落ちて来るほどの人間は、もうさまざまな地獄の責苦に疲れはてて、泣声を出す力さえなくなっているのでございましょう。ですからさすが大泥坊のカン陀多も、やはり血の池の血に咽びながら、まるで死にかかった蛙のように、ただもがいてばかり居りました。ところがある時の事でございます。何気なくカン陀多が頭を挙げて、血の池の空を眺めますと、そのひっそりとした暗の中を、遠い遠い天上から、銀色の蜘蛛の糸が、まるで人目にかかるのを恐れるように、一すじ細く光りながら、するすると自分の上へ垂れて参るのではございませんか。カン陀多はこれを見ると、思わず手を拍って喜びました。この糸に縋りついて、どこまでものぼって行けば、きっと地獄からぬけ出せるのに相違ございません。いや、うまく行くと、極楽へはいる事さえも出来ましょう。そうすれば、もう針の山へ追い上げられる事もなくなれば、血の池に沈められる事もある筈はございません。こう思いましたからカン陀多は、早速その蜘蛛の糸を両手でしっかりとつかみながら、一生懸命に上へ上へとたぐりのぼり始めました。元より大泥坊の事でございますから、こう云う事には昔から、慣れ切っているのでございます。しかし地獄と極楽との間は、何万里となくございますから、いくら焦って見た所で、容易に上へは出られません。ややしばらくのぼる中に、とうとうカン陀多もくたびれて、もう一たぐりも上の方へはのぼれなくなってしまいました。そこで仕方がございませんから、まず一休み休むつもりで、糸の中途にぶら下りながら、遥かに目の下を見下しました。すると、一生懸命にのぼった甲斐があって、さっきまで自分がいた血の池は、今ではもう暗の底にいつの間にかかくれて居ります。それからあのぼんやり光っている恐しい針の山も、足の下になってしまいました。この分でのぼって行けば、地獄からぬけ出すのも、存外わけがないかも知れません。カン陀多は両手を蜘蛛の糸にからみながら、ここへ来てから何年にも出した事のない声で、「しめた。しめた。」と笑いました。ところがふと気がつきますと、蜘蛛の糸の下の方には、数限もない罪人たちが、自分ののぼった後をつけて、まるで蟻の行列のように、やはり上へ上へ一心によじのぼって来るではございませんか。カン陀多はこれを見ると、驚いたのと恐しいのとで、しばらくはただ、莫迦のように大きな口を開いたまま、眼ばかり動かして居りました。自分一人でさえ断れそうな、この細い蜘蛛の糸が、どうしてあれだけの人数の重みに堪える事が出来ましょう。もし万一途中で断れたと致しましたら、折角ここへまでのぼって来たこの肝腎な自分までも、元の地獄へ逆落しに落ちてしまわなければなりません。そんな事があったら、大変でございます。が、そう云う中にも、罪人たちは何百となく何千となく、まっ暗な血の池の底から、うようよと這い上って、細く光っている蜘蛛の糸を、一列になりながら、せっせとのぼって参ります。今の中にどうかしなければ、糸はまん中から二つに断れて、落ちてしまうのに違いありません。そこでカン陀多は大きな声を出して、「こら、罪人ども。この蜘蛛の糸は己のものだぞ。お前たちは一体誰に尋いて、のぼって来た。下りろ。下りろ。」と喚きました。その途端でございます。今まで何ともなかった蜘蛛の糸が、急にカン陀多のぶら下っている所から、ぷつりと音を立てて断れました。ですからカン陀多もたまりません。あっと云う間もなく風を切って、独楽のようにくるくるまわりながら、見る見る中に暗の底へ、まっさかさまに落ちてしまいました。後にはただ極楽の蜘蛛の糸が、きらきらと細く光りながら、月も星もない空の中途に、短く垂れているばかりでございます。御釈迦様は極楽の蓮池のふちに立って、この一部｜始終をじっと見ていらっしゃいましたが、やがてカン陀多が血の池の底へ石のように沈んでしまいますと、悲しそうな御顔をなさりながら、またぶらぶら御歩きになり始めました。自分ばかり地獄からぬけ出そうとする、カン陀多の無慈悲な心が、そうしてその心相当な罰をうけて、元の地獄へ落ちてしまったのが、御釈迦様の御目から見ると、浅間しく思召されたのでございましょう。しかし極楽の蓮池の蓮は、少しもそんな事には頓着致しません。その玉のような白い花は、御釈迦様の御足のまわりに、ゆらゆら萼を動かして、そのまん中にある金色の蕊からは、何とも云えない好い匂が、絶間なくあたりへ溢れて居ります。極楽ももう午に近くなったのでございましょう。";
let count = 0;
let emojiArr;
let emojis = [];

function setup() {
  createCanvas(800, 800, WEBGL);
  colorMode(HSB, 360, 100, 100, 100);
  angleMode(DEGREES);
	textFont("serif");
  emojiArr = createEmojiArr();
  
  nx1 = random(1500);
  ny1 = random(1500);
  nsA = random(100, 200);
  nx2 = random(15000);
  ny2 = random(15000);
  nsB = random(100, 200);
}

function draw() {
  background(0,0,10);
  let r = 1000;
  let angleA = map(noise(nx1, ny1, frameCount / nsA), 0, 1, 0, 360)
  let angleB = map(noise(nx2, ny2, frameCount / nsB), 0, 1, -180, 180);
  let step = 150;
  let point = createVector(
    cos(angleA) * cos(angleB),
    sin(angleA) * cos(angleB),
    sin(angleB)
  );
  
  let n = int(map(noise(point.x,point.y,point.z),0,1,0,emojiArr.length));
  let g = createGraphics(160,90);
  g.textSize(80);
  g.textAlign(CENTER,CENTER);
  g.fill(255);
  let str = letters[(++count)%letters.length];
  //print(str);
  g.text(str,g.width/2,g.height/2);
  point.mult(r);
  points.push(point);
  images.push(g);

  if (points.length > 300) {
    points.shift();
    images.shift();
  }

  for (let i = points.length - 1; i > 1; i--) {
    let angleE = angleA + i * 5;
    let angleF = angleB - i * 5;
    let s = createVector(
      cos(angleE) * cos(angleF),
      cos(angleE) * sin(angleF),
      sin(angleF)
    ).mult(step);
    //fill(angleE%360,80,100);
    noStroke();

    let p = points[i].copy().add(s);

    push();
    translate(p.x, p.y, p.z);
    rotateX(angleE+180);
    rotateY(angleF+180);
    rotateZ(angleE+180);
    noFill();
    texture(images[i]);
    plane(3 * step, 3 * step * 9 / 16);
    pop();
  //noLoop();
    //print(emojis);
    // beginShape(TRIANGLE_STRIP);
    // let p = points[i].copy().add(s);
    // vertex(
    //   p.x, p.y - step, p.z
    // );
    // vertex(
    //   p.x, p.y + step, p.z
    // );
    // p = points[i + 1].copy().sub(s);
    // vertex(
    //   p.x, p.y + step, p.z
    // );
    // vertex(
    //   p.x, p.y - step, p.z
    // );
    // endShape(CLOSE);
  }
  // for(let i = points.length-1; i >0 ; i--){
  //   let p = points[i];
  //   vertex(
  //     p.x,p.y-2,p.z
  //   );
  // }

  let angleC = frameCount/3;
  let angleD = - frameCount/3;
  let q = createVector(
    cos(angleC) * cos(angleD),
    cos(angleC) * sin(angleD),
    sin(angleD)
    
  ).mult(sin(frameCount));
  camera(point.z,point.x,point.y,point.x, point.y, point.z,  0, 1, 0);


}

function createEmojiArr() {
  let arr = [];
  let emoji;
  for (let i = 128512; i < 128592; i++) {
    emoji = String.fromCodePoint(i);
    arr.push(emoji);
  }
  for (let i = 127744; i < 128318; i++) {
    emoji = String.fromCodePoint(i);
    arr.push(emoji);
  }
  return arr;
}